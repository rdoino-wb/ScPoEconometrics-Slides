---
title: "Think Large, Dive Deep: Mastering Administrative Data"
subtitle: "Designing, Manipulating and Visualizing"
author: "Ruggero Doino"
date: "DIME 3 </br> `r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, "../css/scpo.css", "../css/scpo-fonts.css"]
    nature:
      beforeInit: ["../js/ru_xaringan.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
    includes:
      in_header: "../libs/partials/header.html"
---

layout: true

<div class="my-footer"><img src="../img/logo/WBG_Vertical-RGB-high.png" style="height: 60px;"/></div> 

---

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
library(data.table)
library(dplyr)

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

library(countdown)

# countdown style
countdown(
  color_border              = "#d90502",
  color_text                = "black",
  color_running_background  = "#d90502",
  color_running_text        = "white",
  color_finished_background = "white",
  color_finished_text       = "#d90502",
  color_finished_border     = "#d90502"
)

#library(learnr) # this line needs to be run manually I have no idea why but otherwise I get this error message which I can't seem to solve...
# Quitting from lines 27-40 (chapter2.Rmd) 
# Error: package or namespace load failed for 'learnr':
#  .onAttach failed in attachNamespace() for 'learnr', details:
#   call: NULL
#   error: The shiny_prerendered_chunk function can only be called from within runtime: shiny_prerendered
```

  
# Working With Data

* Econometrics is about `data`.

```{r, echo = F, out.width = "400px"}
knitr::include_graphics("chapter_tidy_files/figure-html/data_science_pipeline.png")
```

--

* According a to [2014 NYTimes article](https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html), "data scientists [...] spend from ***50 percent to 80 percent of their time*** mired in this more mundane labor of collecting and preparing unruly digital data, before it can be explored for useful nuggets."

* In the next hour you will learn how to approach ***large***, ***nested*** and ***administrative*** data

---

layout: false
class: title-slide-section-red, middle

# What we have in our toolbox `r emo::ji("toolbox")`

---

# Pacakges we all use daily 

.pull-left-narrow[.center[<img src="../img/logo/dplyr.png" width="125px"/>]]
.pull-right-wide[
Tyding, Manipulating and Merging
]

--

.pull-left-narrow[.center[<img src="../img/logo/magrittr.svg" width="65px"/>]]

.pull-right-wide[
- The wonder tool ` %>% `...
- ... but you will see me using ` |> ` `r emo::ji("exploding head")`
]

--

.pull-left-narrow[.center[<img src="../img/logo/lubridate.png" width="65px"/>]]

.pull-right-wide[
Makes dating fun
]

--

.pull-left-narrow[.center[<img src="../img/logo/stringr.png" width="65px"/>]]

.pull-right-wide[
Makes texting fun
]

--

.pull-left-narrow[.center[<img src="../img/logo/ggplot2.svg" width="65px"/>]]

.pull-right-wide[
Makes visualizing fun
]

--

.pull-left-narrow[.center[<img src="../img/logo/fixest.png" width="65px"/>]]

.pull-right-wide[
Makes regressing fun
]

---
class: title-slide, top, left, inverse
background-image: url("../img/logo/einsteinoppenheimer.jpg")
background-size: cover

---

layout: true

<div class="my-footer"><img src="../img/logo/WBG_Vertical-RGB-high.png" style="height: 60px;"/></div> 

# Why Aren't You Using data.table Yet?

.left-thin[

### Coincise

]

---

1) Concise
These two code chunks do the same thing:

# library(dplyr) ## Already loaded
# data(starwars, package = "dplyr") ## Optional to bring the DF into the global env
starwars %>% 
  filter(species=="Human") %>% 
  group_by(homeworld) %>% 
  summarise(mean_height=mean(height))
vs

# library(data.table) ## Already loaded
starwars_dt = as.data.table(starwars)
starwars_dt[species=="Human", mean(height), by=homeworld]

.right-wide[
These two code chunks do the same thing:

**Dplyr**

```{r, echo=FALSE}
# library(dplyr) ## Already loaded
# data(starwars, package = "dplyr") ## Optional to bring the DF into the global env

starwars %>% 
  filter(species=="Human") %>% 
  group_by(homeworld) %>% 
  summarise(mean_height=mean(height))
```

**Dplyr**

```{r, echo=FALSE}
# library(dplyr)
# data(starwars, package = "dplyr")

starwars %>% 
  filter(species=="Human") %>% 
  group_by(homeworld) %>% 
  summarise(mean_height=mean(height))
```

vs

```{r, echo=FALSE}
# library(data.table)

starwars_dt = as.data.table(starwars)
starwars_dt[species=="Human", mean(height), by=homeworld]

```

]

---

.right-wide[
*Example:* Which polls had a sample size of at least 2,000 people?
]

.right-wide[
```{r, eval=FALSE}
polls_us_election_2016 #<<
```

```{r, echo=FALSE}
polls_us_election_2016 #<<
```
]

---

.right-wide[
*Example:* Which polls had a sample size of at least 2,000 people?
]

.right-wide[
```{r, eval=FALSE}
polls_us_election_2016 %>%
  filter(samplesize > 2000) #<<
```

```{r, echo=FALSE}
polls_us_election_2016 %>%
  filter(samplesize > 2000)
```
]

---

.right-wide[
Standard suite of comparison operators:
- `>`: greater than,
- `<`: smaller than,
- `>=`: greater than or equal to,
- `<=`: smaller than or equal to,
- `!=`: not equal to,
- `==`: equal to.

Logical operators:
1. `x & y`: `x` **and** `y`
1. `x | y`: `x` **or** `y`
1. `!y`: **not** `y`
]

---

.right-wide[
`R` has the convenient `x %in% y` operator (conversely `!(x %in% y)`), `TRUE` if `x` is *a member of* `y`.
```{r, echo = TRUE}
3 %in% 1:3
c(2,5) %in% 2:10  # also vectorized
c("S","Po") %in% c("Sciences","Po")  # also strings
```
]

---

.right-wide[
*Example:* Which A graded poll with at least 2,000 people had Trump win at least 45% of the vote?
]

---

.right-wide[
*Example:* Which A graded poll with at least 2,000 people had Trump win at least 45% of the vote?
]

.right-wide[
```{r, eval=FALSE}
polls_us_election_2016 #<<
```

```{r, echo=FALSE}
polls_us_election_2016 #<<
```
]

---

.right-wide[
*Example:* Which A graded poll with at least 2,000 people had Trump win at least 45% of the vote?
]

.right-wide[
```{r, eval=FALSE}
polls_us_election_2016 %>%
  filter(grade == "A" & samplesize > 2000 & rawpoll_trump > 45) #<<
```

```{r, echo=FALSE}
polls_us_election_2016 %>%
  filter(grade == "A" & samplesize > 2000 & rawpoll_trump > 45)
```
]

---

layout: true

<div class="my-footer"><img src="../img/logo/WBG_Vertical-RGB-high.png" style="height: 60px;"/></div> 

# Why should You Use data.table?

.left-thin[

### Coincise

### Create new variable(s)

```r
mutate()
```

]

---

.right-wide[
*Example:* What was
1. the combined vote share of Trump and Clinton for each poll?
2. the difference between Trump's raw poll vote share and 538's adjusted vote share?
]

---

.right-wide[
*Example:* What was
1. the combined vote share of Trump and Clinton for each poll?
2. the difference between Trump's raw poll vote share and 538's adjusted vote share?
]

.right-wide[
```{r, eval=FALSE}
polls_us_election_2016
```

```{r, echo=FALSE}
polls_us_election_2016
```
]

---

.right-wide[
*Example:* What was
1. the combined vote share of Trump and Clinton for each poll?
2. the difference between Trump's raw poll vote share and 538's adjusted vote share?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  mutate(trump_clinton_tot = rawpoll_trump + rawpoll_clinton, #<<
         trump_raw_adj_diff = rawpoll_trump - adjpoll_trump) #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  mutate(trump_clinton_tot = rawpoll_trump + rawpoll_clinton,
         trump_raw_adj_diff = rawpoll_trump - adjpoll_trump)
```
]

---

.right-wide[
*Example:* What was
1. the combined vote share of Trump and Clinton for each poll?
2. the difference between Trump's raw poll vote share and 538's adjusted vote share?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  mutate(trump_clinton_tot = rawpoll_trump + rawpoll_clinton,
         trump_raw_adj_diff = rawpoll_trump - adjpoll_trump) %>%
  names() #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  mutate(trump_clinton_tot = rawpoll_trump + rawpoll_clinton,
         trump_raw_adj_diff = rawpoll_trump - adjpoll_trump) %>%
  names()
```
]

---

layout: true

<div class="my-footer"><img src="../img/logo/WBG_Vertical-RGB-high.png" style="height: 60px;"/></div> 

# Why should You Use data.table?

.left-thin[

### Coincise

### Insanely fast

### Memory efficient

```r
select()
```

]

---

.right-wide[
*Example:* Only keep the variables `state, startdate, enddate, pollster, rawpoll_clinton, rawpoll_trump`
]

---

.right-wide[
*Example:* Only keep the variables `state, startdate, enddate, pollster, rawpoll_clinton, rawpoll_trump`
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016
```

```{r, echo = FALSE}
polls_us_election_2016
```
]

---

.right-wide[
*Example:* Only keep the variables `state, startdate, enddate, pollster, rawpoll_clinton, rawpoll_trump`
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  select(state,startdate,enddate,pollster,rawpoll_clinton,rawpoll_trump) #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  select(state,startdate,enddate,pollster,rawpoll_clinton,rawpoll_trump)
```
]

---

.right-wide[
*Example:* Only keep the variables `state, startdate, enddate, pollster, rawpoll_clinton, rawpoll_trump`
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  select(state,startdate,enddate,pollster,rawpoll_clinton,rawpoll_trump) %>%
  names() #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  select(state,startdate,enddate,pollster,rawpoll_clinton,rawpoll_trump) %>%
  names()
```
]

---

layout: true

<div class="my-footer"><img src="../img/logo/WBG_Vertical-RGB-high.png" style="height: 60px;"/></div> 

# Why should You Use data.table?

.left-thin[

### Coincise

### Insanely fast

### Select

### Feature rich (and stable)

```r
summarise()
```

]

---

.right-wide[
*Example:* What is the maximum vote share for Trump?
]

---

.right-wide[
*Example:* What is the maximum vote share for Trump?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016
```

```{r, echo = FALSE}
polls_us_election_2016
```
]

---

.right-wide[
*Example:* What is the maximum vote share for Trump?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  summarise(max_trump = max(rawpoll_trump)) #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  summarise(max_trump = max(rawpoll_trump))
```
]

---

layout: true

<div class="my-footer"><img src="../img/logo/WBG_Vertical-RGB-high.png" style="height: 60px;"/></div> 

# Why should You Use data.table?

.left-thin[

### Coincise

### Insanely fast

### Select

### Feature rich (and stable)

### Dependency free

```r
group_by()
```

]

---

.right-wide[
*Example:* What is the average vote share for Clinton by poll grade?
]

---

.right-wide[
*Example:* What is the average vote share for Clinton by poll grade?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016
```

```{r, echo = FALSE}
polls_us_election_2016
```
]

---

.right-wide[
*Example:* What is the average vote share for Clinton by poll grade?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  group_by(grade) #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  group_by(grade)
```
]

---

.right-wide[
*Example:* What is the average vote share for Clinton by poll grade?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  group_by(grade) %>%
  class() #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  group_by(grade) %>%
  class()
```
]

---

.right-wide[
*Example:* What is the average vote share for Clinton by poll grade?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  group_by(grade) #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  group_by(grade)
```
]

---

.right-wide[
*Example:* What is the average vote share for Clinton by poll grade?
]

.right-wide[
```{r, eval = FALSE}
polls_us_election_2016 %>%
  group_by(grade) %>%
  summarise(mean_vote_clinton = mean(rawpoll_clinton)) #<<
```

```{r, echo = FALSE}
polls_us_election_2016 %>%
  group_by(grade) %>%
  summarise(mean_vote_clinton = mean(rawpoll_clinton))
```
]

---









